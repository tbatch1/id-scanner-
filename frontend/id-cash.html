<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Redirecting to Scanner...</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #0d111b;
            color: #f4f6ff;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
    </style>
</head>
<body>
    <p>Redirecting to scanner...</p>
    <script>
        // Parse query parameters from the current URL (of the iframe)
        const urlParams = new URLSearchParams(window.location.search);
        const registerId = urlParams.get('register_id');
        const amount = urlParams.get('amount') || '0.00';
        const outletId = urlParams.get('outlet_id') || '02f4a1bc-ae66-11f0-f174-8d8eeff9231e';
        const employeeId = urlParams.get('employee_id');
        const employeeName = urlParams.get('employee_name');
        const saleId = urlParams.get('sale_id');

        // Generate a unique session ID (or use sale_id if provided)
        const sessionId = saleId || 'SCAN-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);

        // Construct the destination URL for the standalone scanner page
        let scannerUrl = window.location.origin + '/scanner.html?session_id=' + sessionId +
                          '&register_id=' + registerId +
                          '&amount=' + amount +
                          '&outlet_id=' + outletId;

        // Add employee info if provided
        if (employeeId) {
            scannerUrl += '&employee_id=' + employeeId;
        }
        if (employeeName) {
            scannerUrl += '&employee_name=' + encodeURIComponent(employeeName);
        }

        // Redirect the main browser window (not just the iframe) to the scanner URL.
        // This is the key part to "break out" of the iframe.
        if (window.top) {
            window.top.location.href = scannerUrl;
        } else {
            // Fallback if not in an iframe
            window.location.href = scannerUrl;
        }
    </script>
</body>
</html>
